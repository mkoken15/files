<!DOCTYPE html><html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestionnaire de fichiers</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 1rem;
      background-color: #f7f7f7;
    }
    header {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    input, select, button {
      padding: 0.5rem;
      font-size: 1rem;
      border-radius: 0.5rem;
      border: 1px solid #ccc;
    }
    .folder {
      margin-top: 1rem;
    }
    .folder h3 {
      margin-bottom: 0.5rem;
    }
    .file-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 1rem;
    }
    .file-grid img, .file-grid video {
      width: 100%;
      max-height: 150px;
      object-fit: cover;
      border-radius: 0.5rem;
    }
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }
    .modal-content {
      max-width: 90%;
      max-height: 90%;
    }
    .modal-content img, .modal-content video {
      width: 100%;
      height: auto;
    }
  </style>
</head>
<body>
  <header>
    <input type="text" id="folderName" placeholder="Nom du dossier">
    <button onclick="createFolder()">Créer un dossier</button>
    <input type="file" id="fileInput" multiple onchange="addFiles()">
    <select id="folderSelect"></select>
    <select id="sortSelect" onchange="loadFolders()">
      <option value="last">Dernier ajout</option>
      <option value="alpha">Ordre alphabétique</option>
    </select>
  </header>  <main id="folderList"></main>  <div id="modal" class="modal" style="display:none" onclick="closeModal()">
    <div class="modal-content" id="modalContent"></div>
  </div>  <script>
    let db;
    const request = indexedDB.open("FileManagerDB", 1);

    request.onerror = () => alert("Erreur lors de l'ouverture de la base de données");

    request.onsuccess = (event) => {
      db = event.target.result;
      loadFolders();
    };

    request.onupgradeneeded = (event) => {
      db = event.target.result;
      db.createObjectStore("folders", { keyPath: "id", autoIncrement: true });
    };

    function createFolder() {
      const name = document.getElementById("folderName").value.trim();
      if (!name) return alert("Nom de dossier requis");

      const tx = db.transaction("folders", "readwrite");
      const store = tx.objectStore("folders");
      store.add({ name, files: [] });
      tx.oncomplete = () => {
        document.getElementById("folderName").value = "";
        loadFolders();
      };
    }

    function addFiles() {
      const files = Array.from(document.getElementById("fileInput").files);
      const folderId = parseInt(document.getElementById("folderSelect").value);
      if (isNaN(folderId)) return alert("Sélectionnez un dossier");

      const tx = db.transaction("folders", "readwrite");
      const store = tx.objectStore("folders");
      const request = store.get(folderId);
      request.onsuccess = () => {
        const folder = request.result;
        const readerPromises = files.map(file => new Promise(resolve => {
          const reader = new FileReader();
          reader.onload = () => resolve({ name: file.name, type: file.type, content: reader.result });
          reader.readAsDataURL(file);
        }));
        Promise.all(readerPromises).then(results => {
          folder.files.push(...results);
          store.put(folder);
          tx.oncomplete = loadFolders;
        });
      };
    }

    function loadFolders() {
      const sortMethod = document.getElementById("sortSelect").value;
      const tx = db.transaction("folders", "readonly");
      const store = tx.objectStore("folders");
      const request = store.getAll();

      request.onsuccess = () => {
        const data = request.result;

        if (sortMethod === "alpha") {
          data.sort((a, b) =>
            a.name.normalize('NFD').replace(/[̀-ͯ]/g, '').toLowerCase()
              .localeCompare(
                b.name.normalize('NFD').replace(/[̀-ͯ]/g, '').toLowerCase(),
                'tr',
                { sensitivity: 'base' }
              )
          );
        } else {
          data.sort((a, b) => b.id - a.id);
        }

        updateFolderSelect(data.map(f => ({ id: f.id, name: f.name })));

        const folderList = document.getElementById("folderList");
        folderList.innerHTML = "";

        data.forEach(folder => {
          const section = document.createElement("section");
          section.className = "folder";
          section.innerHTML = `<h3>${folder.name}</h3>`;

          const grid = document.createElement("div");
          grid.className = "file-grid";

          folder.files.forEach(file => {
            const elem = document.createElement(file.type.startsWith("image") ? "img" : "video");
            elem.src = file.content;
            if (file.type.startsWith("video")) elem.controls = true;
            elem.onclick = () => openModal(file);
            grid.appendChild(elem);
          });

          section.appendChild(grid);
          folderList.appendChild(section);
        });
      };
    }

    function updateFolderSelect(folders) {
      const select = document.getElementById("folderSelect");
      select.innerHTML = "<option disabled selected>Choisissez un dossier</option>";
      folders.forEach(folder => {
        const option = document.createElement("option");
        option.value = folder.id;
        option.textContent = folder.name;
        select.appendChild(option);
      });
    }

    function openModal(file) {
      const modal = document.getElementById("modal");
      const content = document.getElementById("modalContent");
      content.innerHTML = file.type.startsWith("image")
        ? `<img src="${file.content}" alt="image">`
        : `<video src="${file.content}" controls autoplay></video>`;
      modal.style.display = "flex";
    }

    function closeModal() {
      document.getElementById("modal").style.display = "none";
    }
  </script></body>
</html>