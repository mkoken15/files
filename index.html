<!DOCTYPE html><html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Gestionnaire de Fichiers Local (IndexedDB)</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f4f4f4;
      padding: 20px;
    }
    h1, h2 {
      color: #333;
    }
    .section {
      background: #fff;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    input, select, button {
      padding: 8px;
      margin: 5px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    .folder {
      margin-top: 20px;
    }
    .preview img, .preview video {
      max-width: 200px;
      margin: 10px;
      border-radius: 8px;
    }
    .preview video {
      max-height: 150px;
    }
    .file-actions button {
      margin-left: 10px;
      background-color: #f44336;
    }
    .file-actions button:hover {
      background-color: #d32f2f;
    }
  </style>
</head>
<body>
  <h1>üìÅ Gestionnaire de Fichiers Local</h1>  <div class="section">
    <h2>Cr√©er un dossier</h2>
    <input type="text" id="folderName" placeholder="Nom du dossier">
    <button onclick="createFolder()">Cr√©er</button>
  </div>  <div class="section">
    <h2>Ajouter des fichiers</h2>
    <select id="folderSelect">
      <option disabled selected>-- Choisir un dossier --</option>
    </select>
    <input type="file" id="fileInput" multiple>
    <button onclick="addFiles()">Ajouter</button>
  </div>  <div class="section">
    <h2>Dossiers et Fichiers</h2>
    <div id="foldersContainer"></div>
  </div>  <script>
    const DB_NAME = "FileManagerDB";
    const DB_VERSION = 1;
    const STORE_NAME = "files";
    let db;

    function openDB() {
      const request = indexedDB.open(DB_NAME, DB_VERSION);

      request.onerror = () => alert("Erreur d'acc√®s √† IndexedDB");

      request.onupgradeneeded = (event) => {
        db = event.target.result;
        db.createObjectStore(STORE_NAME, { keyPath: "id", autoIncrement: true });
      };

      request.onsuccess = (event) => {
        db = event.target.result;
        loadFolders();
      };
    }

    function saveFile(folder, file, dataURL) {
      const tx = db.transaction(STORE_NAME, "readwrite");
      const store = tx.objectStore(STORE_NAME);
      const fileRecord = { folder, name: file.name, type: file.type, data: dataURL };
      store.add(fileRecord).onsuccess = () => loadFolders();
    }

    function loadFolders() {
      const tx = db.transaction(STORE_NAME, "readonly");
      const store = tx.objectStore(STORE_NAME);
      const request = store.getAll();

      request.onsuccess = () => {
        const data = request.result;
        const foldersMap = {};
        data.forEach(file => {
          if (!foldersMap[file.folder]) foldersMap[file.folder] = [];
          foldersMap[file.folder].push(file);
        });

        renderFolders(foldersMap);
        updateFolderSelect(Object.keys(foldersMap));
      };
    }

    function renderFolders(foldersMap) {
      const container = document.getElementById("foldersContainer");
      container.innerHTML = "";

      for (let folder in foldersMap) {
        const div = document.createElement("div");
        div.className = "folder";
        div.innerHTML = `<h3>${folder}</h3><div class="preview" id="preview-${folder}"></div>`;

        const preview = div.querySelector('.preview');

        foldersMap[folder].forEach(file => {
          let element;
          if (file.type.startsWith('image')) {
            element = document.createElement('img');
            element.src = file.data;
          } else if (file.type.startsWith('video')) {
            element = document.createElement('video');
            element.src = file.data;
            element.controls = true;
          }
          if (element) {
            const wrapper = document.createElement('div');
            wrapper.style.display = 'inline-block';
            wrapper.appendChild(element);
            const delBtn = document.createElement('button');
            delBtn.textContent = 'Supprimer';
            delBtn.onclick = () => deleteFile(file.id);
            wrapper.appendChild(delBtn);
            preview.appendChild(wrapper);
          }
        });

        container.appendChild(div);
      }
    }

    function updateFolderSelect(folders) {
      const select = document.getElementById("folderSelect");
      const currentValue = select.value;
      select.innerHTML = '<option disabled>-- Choisir un dossier --</option>';
      folders.forEach(f => {
        const opt = document.createElement('option');
        opt.value = f;
        opt.textContent = f;
        select.appendChild(opt);
      });
      if (folders.includes(currentValue)) select.value = currentValue;
    }

    function createFolder() {
      const name = document.getElementById('folderName').value.trim();
      if (!name) return alert("Nom du dossier invalide.");
      const select = document.getElementById('folderSelect');
      const exists = [...select.options].some(o => o.value === name);
      if (!exists) {
        const opt = document.createElement('option');
        opt.value = name;
        opt.textContent = name;
        select.appendChild(opt);
        select.value = name;
      }
      document.getElementById('folderName').value = '';
    }

    function addFiles() {
      const folderName = document.getElementById('folderSelect').value;
      const files = document.getElementById('fileInput').files;
      if (!folderName || files.length === 0) return alert("S√©lectionne un dossier et des fichiers");

      for (let file of files) {
        const reader = new FileReader();
        reader.onload = function(e) {
          saveFile(folderName, file, e.target.result);
        };
        reader.readAsDataURL(file);
      }

      document.getElementById('fileInput').value = '';
    }

    function deleteFile(id) {
      const tx = db.transaction(STORE_NAME, "readwrite");
      const store = tx.objectStore(STORE_NAME);
      store.delete(id).onsuccess = () => loadFolders();
    }

    window.onload = openDB;
  </script></body>
</html>
