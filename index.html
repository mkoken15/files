<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gestionnaire de Fichiers</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 10px;
      margin: 0;
      background: #f0f0f0;
    }

    header {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 15px;
    }

    select, input[type="text"], button, input[type="file"] {
      padding: 10px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      width: 100%;
    }

    .file-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
    }

    .file-item {
      width: 160px;
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      text-align: center;
    }

    .file-item img, .file-item video {
      width: 100%;
      height: auto;
      cursor: pointer;
    }

    .file-item p {
      padding: 5px;
      font-size: 0.9rem;
      word-break: break-word;
    }

    .modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .modal img, .modal video {
      max-width: 90%;
      max-height: 90%;
    }

    @media (max-width: 600px) {
      .file-item {
        width: 45%;
      }
    }
  </style>
</head>
<body>

  <header>
    <input type="text" id="folderInput" placeholder="Nom du dossier" />
    <button onclick="createFolder()">Créer un dossier</button>

    <select id="folderSelect" onchange="loadFolder(this.value)">
      <option disabled selected>-- Choisir un dossier --</option>
    </select>

    <input type="file" id="fileInput" multiple />
    <button onclick="addFiles()">Ajouter</button>

    <select id="sortSelect" onchange="sortAndDisplay()">
      <option value="last">Dernier ajout</option>
      <option value="alpha">Ordre alphabétique</option>
    </select>
  </header>

  <div class="file-grid" id="fileGrid"></div>

  <div id="previewModal" class="modal" style="display:none;" onclick="closePreview()">
    <img id="previewImg" style="display:none;">
    <video id="previewVid" controls style="display:none;"></video>
  </div>

  <script>
    let folders = JSON.parse(localStorage.getItem("folders") || "[]");
    let currentFolder = "";
    let sortMethod = "last";

    function saveFolders() {
      localStorage.setItem("folders", JSON.stringify(folders));
    }

    function createFolder() {
      const name = document.getElementById("folderInput").value.trim();
      if (!name || folders.includes(name)) return;
      folders.push(name);
      saveFolders();
      updateFolderSelect();
      document.getElementById("folderInput").value = "";
    }

    function updateFolderSelect() {
      folders.sort((a, b) => a.localeCompare(b, ['fr', 'tr'], { sensitivity: 'base' }));
      const select = document.getElementById("folderSelect");
      const current = select.value;
      select.innerHTML = '<option disabled>-- Choisir un dossier --</option>';
      folders.forEach(f => {
        const opt = document.createElement("option");
        opt.value = f;
        opt.textContent = f;
        select.appendChild(opt);
      });
      if (folders.includes(current)) select.value = current;
    }

    function loadFolder(folder) {
      currentFolder = folder;
      sortAndDisplay();
    }

    function sortAndDisplay() {
      sortMethod = document.getElementById("sortSelect").value;
      loadFiles();
    }

    function getFolderFiles() {
      return JSON.parse(localStorage.getItem("files_" + currentFolder) || "[]");
    }

    function setFolderFiles(files) {
      localStorage.setItem("files_" + currentFolder, JSON.stringify(files));
    }

    function loadFiles() {
      if (!currentFolder) return;
      const grid = document.getElementById("fileGrid");
      grid.innerHTML = "";
      let files = getFolderFiles();

      if (sortMethod === "alpha") {
        files.sort((a, b) => a.name.localeCompare(b.name, ['fr', 'tr'], { sensitivity: 'base' }));
      } else {
        files.sort((a, b) => b.id - a.id); // dernier ajout
      }

      files.forEach(f => {
        const div = document.createElement("div");
        div.className = "file-item";

        if (f.type.startsWith("image")) {
          const img = document.createElement("img");
          img.src = f.data;
          img.onclick = () => showPreview(f.data, 'img');
          div.appendChild(img);
        } else if (f.type.startsWith("video")) {
          const vid = document.createElement("video");
          vid.src = f.data;
          vid.controls = true;
          vid.onclick = () => showPreview(f.data, 'vid');
          div.appendChild(vid);
        }

        const p = document.createElement("p");
        p.textContent = f.name;
        div.appendChild(p);

        grid.appendChild(div);
      });
    }

    function addFiles() {
      const input = document.getElementById("fileInput");
      if (!input.files.length || !currentFolder) return;
      const files = Array.from(input.files);
      let stored = getFolderFiles();

      let readerCount = 0;
      files.forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
          stored.push({
            id: Date.now() + readerCount++,
            name: file.name,
            type: file.type,
            data: e.target.result
          });
          setFolderFiles(stored);
          loadFiles();
        };
        reader.readAsDataURL(file);
      });
    }

    function showPreview(src, type) {
      const modal = document.getElementById("previewModal");
      const img = document.getElementById("previewImg");
      const vid = document.getElementById("previewVid");
      img.style.display = "none";
      vid.style.display = "none";

      if (type === "img") {
        img.src = src;
        img.style.display = "block";
      } else {
        vid.src = src;
        vid.style.display = "block";
      }

      modal.style.display = "flex";
    }

    function closePreview() {
      const modal = document.getElementById("previewModal");
      modal.style.display = "none";
    }

    // Initialisation
    updateFolderSelect();
  </script>
</body>
</html>